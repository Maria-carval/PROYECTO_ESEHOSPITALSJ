<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ===== FONT AWESOME ===== -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/solid.min.css"
        integrity="sha512-WTx8wN/JUnDrE4DodmdFBCsy3fTGbjs8aYW9VDbW8Irldl56eMj8qUvI3qoZZs9o3o8qFxfGcyQocUY0LYZqzQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

    <!-- ===== BOOTSTRAP ===== -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.6/dist/sweetalert2.all.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
        </script>
    
    <!-- ===== SWEETALERT2 ===== -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.6/dist/sweetalert2.all.min.js"></script>

    <!-- ===== TIME PICKER ===== -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">

    <!-- ===== CSS ===== -->
    <link rel="stylesheet" href="/admin.css">

    <title>APPOITMENTS E.S.E HOSPITAL S.J</title>
</head>

<body>
    <div class="container-fluid">
        <nav
            class="navbar navbar-expand-md navbar-light bg-success bg-opacity-10 border-3 border-bottom border-success">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img src="/images/logo.png" alt="" width="40" height="30" class="d-inline-block align-text-top">
                    Hospital
                </a>
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div id="navbarMenu" class="collapse navbar-collapse">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item"><a class="nav-link" href="#">Agenda</a></li>
                        <li class="nav-item"><a class="nav-link" href="/Solicitudes">Solicitudes</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button"
                                data-bs-toggle="dropdown">Cuenta</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/Inicio">Cerrar sesión</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="pt-4">
            <div class="container pt-4">
                <div class="row">
                    <div class="col-lg-6 pb-5">
                        <div class="card ho border-success mb-3"
                            style="background-color: rgb(162, 235, 162); height: 100%;">
                            <div class="view overlay">
                                <img class="card-img-top" src="/images/medicinageneral.png" alt="">
                                <a href="#">
                                    <div class="mask rgba-white-slight"></div>
                                </a>
                            </div>
                            <div class="card-header">
                                <h5 class="card-title text-center">MEDICINA GENERAL</h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">A continuación podrá agregar la agenda de los médicos generales del
                                    hospital.</p>
                            </div>
                            <div class="card-footer text-center">
                                <button type="button" class="btn btn-success" data-bs-toggle="modal"
                                    data-bs-target="#staticBackdropMed">
                                    Agendar
                                </button>
                                <!-- <a href="#" class="btn btn-success" id="btnMed">Agendar</a> -->
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 pb-5">
                        <div class="card ho border-success mb-3"
                            style="background-color: rgb(162, 235, 162); height: 100%;">
                            <div class="view overlay">
                                <img class="card-img-top" src="/images/odontologia.png" alt="">
                                <a href="#">
                                    <div class="mask rgba-white-slight"></div>
                                </a>
                            </div>
                            <div class="card-header">
                                <h5 class="card-title text-center">ODONTOLOGÍA</h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">A continuación podrá agregar la agenda de los odontólogos del
                                    hospital.</p>
                            </div>
                            <div class="card-footer text-center">
                                <button type="button" class="btn btn-success" data-bs-toggle="modal"
                                data-bs-target="#staticBackdropOdont">
                                Agendar
                            </button>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="col-lg-4 pb-5"></div> -->
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Medicina general -->
    <div class="modal fade" id="staticBackdropMed" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title" id="staticBackdropLabelMed"> <strong>Medicina General</strong></h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="text-align: center;">
                    <p>A continuación podrá ingresar los horarios de los médicos.</p>
                    <div class="col-12 col-sm-12" id="NameOdont">
                        <div class="form-input" style="margin-top: 20px;">
                            <select class="form-select" aria-label="Default select example" id="Medico" name="Medico">
                                <option value="0">Seleccionar médico
                                </option>
                            </select>
                            <div class="w-100 d-none d-md-block"></div>
                            <div class="col-12 col-sm-12" style="margin-top: 20px;">
                                <select class="form-select" aria-label="Default select example" id="Dia" name="Dia">
                                    <option value="0">Seleccionar día</option>
                                    <option value="Lunes">Lunes</option>
                                    <option value="Martes">Martes</option>
                                    <option value="Miércoles">Miércoles</option>
                                    <option value="Jueves">Jueves</option>
                                    <option value="Viernes">Viernes</option>                                 
                                </select>
                            </div>
                            <div class="w-100 d-none d-md-block"></div>
                            <div class="row" style="margin-top: 20px;">
                                <div class="col">
                                    <input type="text" class="form-control" id="H1" name="H1"
                                        placeholder="Hora de Inicio" autocomplete="off" onkeydown="return false">
                                </div>
                                <div class="col">
                                    <input type="text" class="form-control" id="H2" name="H2" placeholder="Hora de Fin"
                                        autocomplete="off" onkeydown="return false">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline waves-effect" id="close" data-bs-dismiss="modal"><i
                            class="fas fa-ban"></i> Cancelar</button>
                    <button type="button" class="btn" id="add" name="add"><i class="fas fa-plus"></i> Agendar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Medicina general -->
    <div class="modal fade" id="staticBackdropOdont" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title" id="staticBackdropLabelOdont"> <strong>Odontología</strong></h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="text-align: center;">
                    <p>A continuación podrá ingresar los horarios de los especialistas.</p>
                    <div class="col-12 col-sm-12" id="NameOdont">
                        <div class="form-input" style="margin-top: 20px;">
                            <select class="form-select" aria-label="Default select example" id="Odontologo" name="Odontologo">
                                <option value="0">Seleccionar odontólogo
                                </option>
                            </select>
                            <div class="w-100 d-none d-md-block"></div>
                            <div class="col-12 col-sm-12" style="margin-top: 20px;">
                                <select class="form-select" aria-label="Default select example" id="Dia1" name="Dia1">
                                    <option value="0">Seleccionar día</option>
                                    <option value="Lunes">Lunes</option>
                                    <option value="Martes">Martes</option>
                                    <option value="Miércoles">Miércoles</option>
                                    <option value="Jueves">Jueves</option>
                                    <option value="Viernes">Viernes</option>                                    
                                </select>
                            </div>
                            <div class="w-100 d-none d-md-block"></div>
                            <div class="row" style="margin-top: 20px;">
                                <div class="col">
                                    <input type="text" class="form-control" id="H3" name="H3"
                                        placeholder="Hora de Inicio" autocomplete="off" onkeydown="return false">
                                </div>
                                <div class="col">
                                    <input type="text" class="form-control" id="H4" name="H4" placeholder="Hora de Fin"
                                        autocomplete="off" onkeydown="return false">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline waves-effect" id="close" data-bs-dismiss="modal"><i
                            class="fas fa-ban"></i> Cancelar</button>
                    <button type="button" class="btn" id="addOdont"><i class="fas fa-plus"></i> Agendar</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ"
    crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>

<script>
    document.onload = loadFunctions();
    function loadFunctions() {
        Medicos();
        Odontologia()
    }

    $("#H1").timepicker({
        timeFormat: 'HH:mm:ss',
        interval: 20,
        minTime: '08:00',
        maxTime: '16:00',
        startTime: '0',
        dynamic: false,
        dropdown: true,
        scrollbar: true,
        change: function (time) {
            var min = 30;
            var time = $(this).val();
            console.log(time)
            var picker = $("#H2");
            picker.timepicker('option', 'minTime', time);
            // picker.timepicker('option', 'disabled', false);
        }
    });

    $("#H2").timepicker({
        timeFormat: 'HH:mm:ss',
        interval: 20,
        maxTime: '16:30',
        startTime: '0',
        dynamic: false,
        dropdown: true,
        scrollbar: true,
        disabled: false
    });

    $("#H3").timepicker({
        timeFormat: 'HH:mm:ss',
        interval: 20,
        minTime: '08:00',
        maxTime: '16:00',
        startTime: '0',
        dynamic: false,
        dropdown: true,
        scrollbar: true,
        change: function (time) {
            var min = 30;
            var time = $(this).val();
            console.log(time)
            var picker = $("#H4");
            picker.timepicker('option', 'minTime', time);
            // picker.timepicker('option', 'disabled', false);
        }
    });

    $("#H4").timepicker({
        timeFormat: 'HH:mm:ss',
        interval: 20,
        maxTime: '16:30',
        startTime: '0',
        dynamic: false,
        dropdown: true,
        scrollbar: true,
        disabled: false
    });


    async function Medicos() {
        var con = document.getElementById('Medico').value;
        const consulta = {
            con: con
        };
        const options = {
            method: "POST",
            body: JSON.stringify(consulta),
            headers: {
                "Content-Type": "application/json"
            }
        };
        const response = await fetch('/ListaMedico', options);
        result = await response.json();
        console.log(result)
        select = document.getElementById('Medico');
        for (var i = 0; i < result.length; i++) {
            var opt = document.createElement('option');
            opt.value = result[i].Doctor;
            opt.innerHTML = result[i].Doctor;
            select.add(opt);
        }
    }

    async function Odontologia() {
        var con = document.getElementById('Odontologo').value;
        const consulta = {
            con: con
        };
        const options = {
            method: "POST",
            body: JSON.stringify(consulta),
            headers: {
                "Content-Type": "application/json"
            }
        };
        const response = await fetch('/ListaOdontologo', options);
        result = await response.json();
        console.log(result)
        select = document.getElementById('Odontologo');
        for (var i = 0; i < result.length; i++) {
            var opt = document.createElement('option');
            opt.value = result[i].Doctor;
            opt.innerHTML = result[i].Doctor;
            select.add(opt);
        }
    }

    $('#add').click(function () {
      let data = DatosFormulario();
      console.log(data)
      if (!data) {
        console.log('error')
      } else {
        agregarDatos(data);
      }      
    })

    function DatosFormulario() {
      let data = {
        Medico: $('#Medico').val(),        
        Dia: $('#Dia').val(),
        H1: $('#H1').val(),
        H2: $('#H2').val()        
      };
      return data;
    }

    function agregarDatos(data) {
      $.ajax({
        type: 'POST',
        url: '/createAgendaMed',
        data: data,
        success: function (msg) {
          Swal.fire(
            '¡Buen trabajo!',
            '¡Se han enviado correctamente los datos!',
            'success'
          )
        },
        error: function (error) {
          Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Hubo un error'
          })
        }
      });
    }

    $('#addOdont').click(function () {
      let data = DatosFormularioOdont();
      console.log(data)
      if (!data) {
        console.log('error')
      } else {
        agregarDatosOdont(data);
      }      
    })

    function DatosFormularioOdont() {
      let data = {
        Odontologo: $('#Odontologo').val(),        
        Dia1: $('#Dia1').val(),
        H3: $('#H3').val(),
        H4: $('#H4').val()        
      };
      return data;
    }

    function agregarDatosOdont(data) {
      $.ajax({
        type: 'POST',
        url: '/createAgendaOdont',
        data: data,
        success: function (msg) {
          Swal.fire(
            '¡Buen trabajo!',
            '¡Se han enviado correctamente los datos!',
            'success'
          )
        },
        error: function (error) {
          Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Hubo un error'
          })
        }
      });
    }

</script>

</html>